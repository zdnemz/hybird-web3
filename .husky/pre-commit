echo "ğŸš€ Running pre-commit checks..."

echo "ğŸ§  Running TypeScript typecheck..."
if ! npm run typecheck; then
  echo "âŒ Typecheck failed. Commit aborted."
  exit 1
else
  echo "âœ… Typecheck passed."
fi

echo "ğŸ“¦ Building project..."
if ! npm run build; then
  echo "âŒ Build failed. Commit aborted."
  exit 1
fi

echo "âœ¨ Formatting staged files with Prettier..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | sed 's| |\\ |g')

if [ -n "$STAGED_FILES" ]; then
  prettier $STAGED_FILES --write --ignore-unknown
  git add $STAGED_FILES
  echo "âœ… Files formatted & staged again."
else
  echo "âš ï¸ No files to format."
fi

echo "ğŸ” Running lint checks..."
if ! npm run lint; then
  echo "âŒ Lint failed. Commit aborted."
  exit 1
else
  echo "âœ… Lint passed."
fi

echo "âœ… Pre-commit checks passed."